<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>

    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
        integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>

    <!-- <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.css">
    </link>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.js"></script> -->



    <script src="./datepicker.js"></script>

    <link rel="stylesheet" href="./datepicker.css">

    <script>
        $(document).ready(function () {

            solonumerosIngresos();//ok
            solonumerosMonto();//ok

            $("#solicitar").prop('disabled', true);//ok
            //carga ciudades
            $.ajax({//ok
                type: "POST",
                url: 'http://piloto.fintra.co:8084/fintracredit/webresources/loans/cities',
                async: false,
                dataType: "json",
                success: function (data) {
                    // console.log("Ciudades:", data);
                    $.each(data, function (key, registro) {
                        $("#citys").append('<option value=' + registro.codigo + '>' + registro.ciudad + '</option>');
                    });
                },
                error: function () {
                    console.log("No se ha podido obtener la informaci贸n");
                }
            });
            //mostrar fechas
            mostrarFechas();//ok
            //calendar
            $("#fecha_expedicion").datepicker({
                format: 'yyyy-mm-dd',
                autoclose: true,
                showOnFocus: true

            });
            //calendar
            $("#fecha_nacimiento").datepicker({
                format: 'yyyy-mm-dd',
                autoclose: true,
                showOnFocus: true
            });
            //evento para desabilitar el boton de solicitar si se ha cambiado el monto.
            $("#monto").change(function () { //ok
                $("#solicitar").prop('disabled', true);
            });

            $("#identificacion").change(function () {//ok
                $("#solicitar").prop('disabled', true);
            });
            //cargar afiliado dependiendo de la ciudad
            $('#citys').change(function () {//ok
                $("#afiliado").html("");
                $('#afiliado').append('<option disabled selected></option>');
                var _ciudad = $(this).val();
                var arr = { ciudad: _ciudad };
                $.ajax({
                    type: "POST",
                    url: 'http://piloto.fintra.co:8084/fintracredit/webresources/hdc/list_affiliates',
                    async: false,
                    dataType: "json",
                    contentType: 'application/json',
                    data: JSON.stringify(arr),
                    success: function (data) {
                        // console.log("list_affiliates:", data.data);                        
                        $.each(data.data, function (key, registro) {
                            $("#afiliado").append('<option value=' + registro.nit_afiliado + '>' + registro.nombre_afiliado + '</option>');
                        });
                    },
                    error: function () {
                        console.log("No se ha podido obtener la informaci贸n");
                    }
                });
            });

            //cargar plazos dependiendo del tipo de carrera
            $('#tipo_carrera').change(function () {//ok
                var plazos = buildDues();
                // console.log("plazos:", plazos);
                $("#num_cuotas").html("");
                $('#num_cuotas').append('<option disabled selected></option>');
                $.each(plazos, function (indice, data) {
                    $("#num_cuotas").append('<option value=' + data + '>' + data + '</option>');
                });
            });

            //Evento que valida al salir del input si cliente existe, si existe inabilita el formulario y 
            //muestra msj informativo, en caso de que no, puede siguir llenando el formulario
            $('#identificacion').change(function () {//ok
                var _identificacion = $(this).val();
                if (validarSiNumero(_identificacion)) {
                    $("#identificacion").removeClass("is-invalid");
                    $.ajax({
                        type: "GET",
                        url: 'http://piloto.fintra.co:8084/fintracredit/webresources/loans/validate_customer/' + _identificacion,
                        contentType: 'application/json',
                        success: function (data) {
                            // console.info("existe:", data.escliente);
                            //  alert("Cliente:"+ (data.escliente == "true" ? "Eres cliente, vamos al login" : "No es cliente"));
                            if (data.escliente == "true") {
                                $("#simular").prop('disabled', true);
                                $("#citys").prop('disabled', true);
                                $("#fecha_pago").prop('disabled', true);
                                $("#afiliado").prop('disabled', true);
                                $("#tipo_carrera").prop('disabled', true);
                                $("#monto").prop('disabled', true);
                                $("#num_cuotas").prop('disabled', true);
                                $("#tipo_identificacion").prop('disabled', true);
                                // $("#identificacion").prop('disabled',true);
                                $("#fecha_expedicion").prop('disabled', true);
                                $("#fecha_nacimiento").prop('disabled', true);
                                $("#primer_apellido").prop('disabled', true);
                                $("#primer_nombre").prop('disabled', true);
                                $("#email").prop('disabled', true);
                                $("#email_confirm").prop('disabled', true);
                                $("#telefono").prop('disabled', true);
                                $("#ingresos_usuario").prop('disabled', true);
                                $("#acceptTerms").prop('disabled', true);
                                // $("#identificacion").focus();
                                document.getElementById("identificacion").focus();
                                alert("Vemos que eres un cliente Fintra, inicia sesi贸n");
                            }
                            else {
                                $("#simular").prop('disabled', false);
                                $("#citys").prop('disabled', false);
                                $("#fecha_pago").prop('disabled', false);
                                $("#afiliado").prop('disabled', false);
                                $("#tipo_carrera").prop('disabled', false);
                                $("#monto").prop('disabled', false);
                                $("#num_cuotas").prop('disabled', false);
                                $("#tipo_identificacion").prop('disabled', false);
                                // $("#identificacion").prop('disabled',true);
                                $("#fecha_expedicion").prop('disabled', false);
                                $("#fecha_nacimiento").prop('disabled', false);
                                $("#primer_apellido").prop('disabled', false);
                                $("#primer_nombre").prop('disabled', false);
                                $("#email").prop('disabled', false);
                                $("#email_confirm").prop('disabled', false);
                                $("#telefono").prop('disabled', false);
                                $("#ingresos_usuario").prop('disabled', false);
                                $("#acceptTerms").prop('disabled', false);
                                document.getElementById("fecha_expedicion").focus();
                            }
                        },
                        error: function () {
                            console.log("No se ha podido obtener la informaci贸n");
                        }
                    });

                }else{
                    $("#identificacion").addClass("is-invalid");
                }
            });

            function buildDues() {//ok
                // alert($("select[id=tipo_carrera]").val());
                var tipo_carera = $("select[id=tipo_carrera]").val();
                var inicial = 0;
                var final = 0;

                if (tipo_carera == 'PREGRADO') {
                    inicial = 6;
                    final = 8;
                } else if (tipo_carera == 'POSGRADO') {
                    inicial = 6;
                    final = 18;
                } else if (tipo_carera == 'CONTINUADA') {
                    inicial = 4;
                    final = 4;
                }
                return buildArrayDues(inicial, final);
            }

            function buildArrayDues(initial, final) { //ok
                let arrayDues = [];

                for (var i = initial; i <= final; i++) {
                    arrayDues.push(parseInt(i))
                }
                return arrayDues;
            }

            function mostrarFechas() {//ok
                var fechas = carcularFecha();
                $.each(fechas, function (indice, color) {
                    $("#fecha_pago").append('<option value=' + color + '>' + color + '</option>');
                });
            }

            function carcularFecha(year, mo, day) { //ok
                var opcion0;
                var opcion1;
                var opcion2;
                var opcion3;
                var date;
                if (year) {
                    date = new Date(year, mo, day);
                } else {
                    date = new Date();
                }

                var days = date.getDate();
                var fecha = "0099-01-01";
                var mes = date.getMonth() + 1;
                var anio = date.getFullYear();



                if (days >= 1 && days <= 2) {

                    if (mes === 12) {

                        fecha = (anio + 1) + "-" + "01" + "-02";
                        opcion0 = new Option(fecha, fecha);
                        fecha = (anio + 1) + "-" + "01" + "-12";
                        opcion1 = new Option(fecha, fecha);
                        fecha = (anio + 1) + "-" + "01" + "-17";
                        opcion2 = new Option(fecha, fecha);
                        fecha = (anio + 1) + "-" + "01" + "-22";
                        opcion3 = new Option(fecha, fecha);


                    } else {

                        fecha = date.getFullYear() + "-" + ((date.getMonth() + 2) > 9 ? (date.getMonth() + 2) : "0" + (date.getMonth() + 2)) + "-02";
                        opcion0 = new Option(fecha, fecha);
                        fecha = date.getFullYear() + "-" + ((date.getMonth() + 2) > 9 ? (date.getMonth() + 2) : "0" + (date.getMonth() + 2)) + "-12";
                        opcion1 = new Option(fecha, fecha);
                        fecha = date.getFullYear() + "-" + ((date.getMonth() + 2) > 9 ? (date.getMonth() + 2) : "0" + (date.getMonth() + 2)) + "-17";
                        opcion2 = new Option(fecha, fecha);
                        fecha = date.getFullYear() + "-" + ((date.getMonth() + 2) > 9 ? (date.getMonth() + 2) : "0" + (date.getMonth() + 2)) + "-22";
                        opcion3 = new Option(fecha, fecha);


                    }

                }

                if (days > 2 && days <= 12) {

                    if (mes === 12) {

                        fecha = (anio + 1) + "-" + "01" + "-12";
                        opcion0 = new Option(fecha, fecha);
                        fecha = (anio + 1) + "-" + "01" + "-17";
                        opcion1 = new Option(fecha, fecha);
                        fecha = (anio + 1) + "-" + "01" + "-22";
                        opcion2 = new Option(fecha, fecha);
                        fecha = (anio + 1) + "-" + "02" + "-02";
                        opcion3 = new Option(fecha, fecha);


                    } else {

                        fecha = date.getFullYear() + "-" + ((date.getMonth() + 2) > 9 ? (date.getMonth() + 2) : "0" + (date.getMonth() + 2)) + "-12";
                        opcion0 = new Option(fecha, fecha);
                        fecha = date.getFullYear() + "-" + ((date.getMonth() + 2) > 9 ? (date.getMonth() + 2) : "0" + (date.getMonth() + 2)) + "-17";
                        opcion1 = new Option(fecha, fecha);
                        fecha = date.getFullYear() + "-" + ((date.getMonth() + 2) > 9 ? (date.getMonth() + 2) : "0" + (date.getMonth() + 2)) + "-22";
                        opcion2 = new Option(fecha, fecha);
                        if (mes === 11) {
                            fecha = (anio + 1) + "-" + "01" + "-02";
                            opcion3 = new Option(fecha, fecha);
                        } else {
                            fecha = date.getFullYear() + "-" + ((date.getMonth() + 3) > 9 ? (date.getMonth() + 3) : "0" + (date.getMonth() + 3)) + "-02";
                            opcion3 = new Option(fecha, fecha);
                        }

                    }
                }

                if (days > 12 && days <= 17) {

                    if (mes === 12) {

                        fecha = (anio + 1) + "-" + "01" + "-17";
                        opcion0 = new Option(fecha, fecha);
                        fecha = (anio + 1) + "-" + "01" + "-22";
                        opcion1 = new Option(fecha, fecha);
                        fecha = (anio + 1) + "-" + "02" + "-02";
                        opcion2 = new Option(fecha, fecha);
                        fecha = (anio + 1) + "-" + "02" + "-12";
                        opcion3 = new Option(fecha, fecha);


                    } else {
                        fecha = date.getFullYear() + "-" + ((date.getMonth() + 2) > 9 ? (date.getMonth() + 2) : "0" + (date.getMonth() + 2)) + "-17";
                        opcion0 = new Option(fecha, fecha);
                        fecha = date.getFullYear() + "-" + ((date.getMonth() + 2) > 9 ? (date.getMonth() + 2) : "0" + (date.getMonth() + 2)) + "-22";
                        opcion1 = new Option(fecha, fecha);

                        if (mes === 11) {

                            fecha = (anio + 1) + "-" + "01" + "-02";
                            opcion2 = new Option(fecha, fecha);
                            fecha = (anio + 1) + "-" + "01" + "-12";
                            opcion3 = new Option(fecha, fecha);

                        } else {

                            fecha = date.getFullYear() + "-" + ((date.getMonth() + 3) > 9 ? (date.getMonth() + 3) : "0" + (date.getMonth() + 3)) + "-02";
                            opcion2 = new Option(fecha, fecha);
                            fecha = date.getFullYear() + "-" + ((date.getMonth() + 3) > 9 ? (date.getMonth() + 3) : "0" + (date.getMonth() + 3)) + "-12";
                            opcion3 = new Option(fecha, fecha);
                        }
                    }

                }

                if (days > 17 && days <= 22) {

                    if (mes === 12) {

                        fecha = (anio + 1) + "-" + "01" + "-22";
                        opcion0 = new Option(fecha, fecha);
                        fecha = (anio + 1) + "-" + "02" + "-02";
                        opcion1 = new Option(fecha, fecha);
                        fecha = (anio + 1) + "-" + "02" + "-12";
                        opcion2 = new Option(fecha, fecha);
                        fecha = (anio + 1) + "-" + "02" + "-17";
                        opcion3 = new Option(fecha, fecha);


                    } else {

                        fecha = date.getFullYear() + "-" + ((date.getMonth() + 2) > 9 ? (date.getMonth() + 2) : "0" + (date.getMonth() + 2)) + "-22";
                        opcion0 = new Option(fecha, fecha);

                        if (mes === 11) {

                            fecha = (anio + 1) + "-" + "01" + "-02";
                            opcion1 = new Option(fecha, fecha);
                            fecha = (anio + 1) + "-" + "01" + "-12";
                            opcion2 = new Option(fecha, fecha);
                            fecha = (anio + 1) + "-" + "01" + "-17";
                            opcion3 = new Option(fecha, fecha);

                        } else {

                            fecha = date.getFullYear() + "-" + ((date.getMonth() + 3) > 9 ? (date.getMonth() + 3) : "0" + (date.getMonth() + 3)) + "-02";
                            opcion1 = new Option(fecha, fecha);
                            fecha = date.getFullYear() + "-" + ((date.getMonth() + 3) > 9 ? (date.getMonth() + 3) : "0" + (date.getMonth() + 3)) + "-12";
                            opcion2 = new Option(fecha, fecha);
                            fecha = date.getFullYear() + "-" + ((date.getMonth() + 3) > 9 ? (date.getMonth() + 3) : "0" + (date.getMonth() + 3)) + "-17";
                            opcion3 = new Option(fecha, fecha);
                        }
                    }

                }


                if (days > 22 && days <= 31) {

                    if (mes === 12) {

                        fecha = (anio + 1) + "-" + "02" + "-02";
                        opcion0 = new Option(fecha, fecha);
                        fecha = (anio + 1) + "-" + "02" + "-12";
                        opcion1 = new Option(fecha, fecha);
                        fecha = (anio + 1) + "-" + "02" + "-17";
                        opcion2 = new Option(fecha, fecha);
                        fecha = (anio + 1) + "-" + "02" + "-22";
                        opcion3 = new Option(fecha, fecha);


                    } else {

                        if (mes === 11) {

                            fecha = (anio + 1) + "-" + "01" + "-02";
                            opcion0 = new Option(fecha, fecha);
                            fecha = (anio + 1) + "-" + "01" + "-12";
                            opcion1 = new Option(fecha, fecha);
                            fecha = (anio + 1) + "-" + "01" + "-17";
                            opcion2 = new Option(fecha, fecha);
                            fecha = (anio + 1) + "-" + "01" + "-22";
                            opcion3 = new Option(fecha, fecha);


                        } else {

                            fecha = date.getFullYear() + "-" + ((date.getMonth() + 3) > 9 ? (date.getMonth() + 3) : "0" + (date.getMonth() + 3)) + "-02";
                            opcion0 = new Option(fecha, fecha);
                            fecha = date.getFullYear() + "-" + ((date.getMonth() + 3) > 9 ? (date.getMonth() + 3) : "0" + (date.getMonth() + 3)) + "-12";
                            opcion1 = new Option(fecha, fecha);
                            fecha = date.getFullYear() + "-" + ((date.getMonth() + 3) > 9 ? (date.getMonth() + 3) : "0" + (date.getMonth() + 3)) + "-17";
                            opcion2 = new Option(fecha, fecha);
                            fecha = date.getFullYear() + "-" + ((date.getMonth() + 3) > 9 ? (date.getMonth() + 3) : "0" + (date.getMonth() + 3)) + "-22";
                            opcion3 = new Option(fecha, fecha);

                        }

                    }
                }

                return [opcion0.value, opcion1.value, opcion2.value, opcion3.value]
            }

            $("#simular").click(function (event) {
                event.preventDefault();
                var citys = $("#citys").val();
                var fecha_pago = $("#fecha_pago").val();
                var afiliado = $("#afiliado").val();
                var tipo_carrera = $("#tipo_carrera").val();
                var monto = ($("#monto").val()).replace(/,/g, "");
                var num_cuotas = $("#num_cuotas").val();
                var tipo_identificacion = $("#tipo_identificacion").val();
                var identificacion = $("#identificacion").val();
                var fecha_expedicion = $("#fecha_expedicion").val();
                var fecha_nacimiento = $("#fecha_nacimiento").val();
                var primer_apellido = $("#primer_apellido").val();
                var primer_nombre = $("#primer_nombre").val();
                var email = $("#email").val();
                var email_confirm = $("#email_confirm").val();
                var telefono = $("#telefono").val();
                var ingresos_usuario = ($("#ingresos_usuario").val()).replace(/,/g, "");
                var acceptTerms = document.getElementById('acceptTerms');

                let val1 = fecha_nacimiento.split("-");
                let val2 = fecha_expedicion.split("-");
                let ano1 = val1[0];
                let ano2 = val2[0];
                // if (nac == "" || nac != null) {
                //     if (ano2 < ano1) {
                //         $(field).addClass("is-invalid");
                //     } else if ((ano2 - ano1) < 18) {
                //         $(field).addClass("is-invalid");
                //     } else {
                //         $(field).removeClass("is-invalid");
                //     }
                // }

                //Remove Class: $("p").removeClass("myClass yourClass")
                //Add Class: $("#identificacion").addClass("is-invalid");
                // $("input ").addClass("is-valid");
                // $("select ").addClass("is-valid");
                // $("select ").addClass("is-valid");

                if (citys == null || citys.length == 0) {
                    $("#citys").addClass("is-invalid");
                } else if (fecha_pago == null || fecha_pago.length == 0) {
                    $("#fecha_pago").addClass("is-invalid");
                } else if (afiliado == null || afiliado.length == 0) {
                    $("#afiliado").addClass("is-invalid");
                } else if (tipo_carrera === null || tipo_carrera == 0) {
                    $("#tipo_carrera").addClass("is-invalid");
                } else if (monto == null || monto.length == 0) {
                    $("#monto").addClass("is-invalid");
                } else if (num_cuotas == null || num_cuotas.length == 0) {
                    $("#num_cuotas").addClass("is-invalid");
                } else if (tipo_identificacion == null || tipo_identificacion.length == 0) {
                    $("#tipo_identificacion").addClass("is-invalid");
                } else if (identificacion == null || isNaN(identificacion) || identificacion.length == 0 || /^\s+$/.test(identificacion)) {
                    $("#identificacion").addClass("is-invalid");
                } else if (primer_apellido.length == 0 || /^\s+$/.test(primer_apellido)) {
                    $("#primer_apellido").addClass("is-invalid");
                } else if (primer_nombre.length == 0 || /^\s+$/.test(primer_nombre)) {
                    $("#primer_nombre").addClass("is-invalid");
                } else if (validateEmail(email)) {
                    $("#email").addClass("is-invalid");
                } else if (validateEmail(email)) {
                    $("#email_confirm").addClass("is-invalid");
                } else if (telefono.length == 0 || !validarSiNumero(telefono)) {
                    $("#telefono").addClass("is-invalid");
                } else if (ingresos_usuario.length == 0 || /^\s+$/.test(ingresos_usuario)) {
                    $("#ingresos_usuario").addClass("is-invalid");
                } else if (acceptTerms.checked == false) {
                    $("#not_accept_term").show();
                } else if (email != email_confirm) {
                    $("#email").addClass("is-invalid");
                    $("#email_confirm").addClass("is-invalid");
                } else if ((ano2 < ano1) || ((ano2 - ano1) < 18)) {
                    $("#fecha_expedicion").addClass("is-invalid");
                } else {
                    $("select").removeClass("is-invalid");
                    $("input").removeClass("is-invalid");
                    $("#not_accept_term").hide();
                    console.log("Form Correct!");

                    var arr = {
                        monto: monto,
                        num_cuotas: num_cuotas,
                        fecha_pago: fecha_pago,
                        id_convenio: 58,
                        und_neg: 31,
                        identificacion: identificacion
                    };
                    $.ajax({
                        type: "POST",
                        url: 'http://192.168.140.155:8084/fintracredit/webresources/loans/approximate_fee',
                        async: false,
                        dataType: "json",
                        contentType: 'application/json',
                        data: JSON.stringify(arr),
                        success: function (data) {
                            // console.log(data);                            
                            document.getElementById("valor_cuota").innerHTML = data.valor_cuota;
                            document.getElementById("valor_aval").innerHTML = data.valor_aval;
                            $("#solicitar").prop('disabled', false);                            
                            $("#sim").show();
                        },
                        error: function () {
                            console.log("No se ha podido obtener la informaci贸n");
                        }
                    });
                }
            });

            $("#solicitar").click(function (event) {
                event.preventDefault();
                var citys = $("#citys").val();
                var fecha_pago = $("#fecha_pago").val();
                var afiliado = $("#afiliado").val();
                var tipo_carrera = $("#tipo_carrera").val();
                var monto = ($("#monto").val()).replace(/,/g, "");;
                var num_cuotas = $("#num_cuotas").val();
                var tipo_identificacion = $("#tipo_identificacion").val();
                var identificacion = $("#identificacion").val();
                var fecha_expedicion = $("#fecha_expedicion").val();
                var fecha_nacimiento = $("#fecha_nacimiento").val();
                var primer_apellido = $("#primer_apellido").val();
                var primer_nombre = $("#primer_nombre").val();
                var email = $("#email").val();
                var email_confirm = $("#email_confirm").val();
                var telefono = $("#telefono").val();
                var ingresos_usuario = ($("#ingresos_usuario").val()).replace(/,/g, "");;
                var acceptTerms = document.getElementById('acceptTerms');
                var valor_cuota = $("#valor_cuota").text();
                var valor_aval = $("#valor_aval").text();

                let val1 = fecha_nacimiento.split("-");
                let val2 = fecha_expedicion.split("-");
                let ano1 = val1[0];
                let ano2 = val2[0];

                //Remove Class: $("p").removeClass("myClass yourClass")
                //Add Class: $("#identificacion").addClass("is-invalid");
                // $("input ").addClass("is-valid");
                // $("select ").addClass("is-valid");
                // $("select ").addClass("is-valid");

                if (citys == null || citys.length == 0) {
                    $("#citys").addClass("is-invalid");
                } else if (fecha_pago == null || fecha_pago.length == 0) {
                    $("#fecha_pago").addClass("is-invalid");
                } else if (afiliado == null || afiliado.length == 0) {
                    $("#afiliado").addClass("is-invalid");
                } else if (tipo_carrera === null || tipo_carrera == 0) {
                    $("#tipo_carrera").addClass("is-invalid");
                } else if (monto == null || monto.length == 0) {
                    $("#monto").addClass("is-invalid");
                } else if (num_cuotas == null || num_cuotas.length == 0) {
                    $("#num_cuotas").addClass("is-invalid");
                } else if (tipo_identificacion == null || tipo_identificacion.length == 0) {
                    $("#tipo_identificacion").addClass("is-invalid");
                } else if (identificacion == null || isNaN(identificacion) || identificacion.length == 0 || /^\s+$/.test(identificacion)) {
                    $("#identificacion").addClass("is-invalid");
                } else if (fecha_expedicion == null || fecha_expedicion.length == 0) {
                    $("#fecha_expedicion").addClass("is-invalid");
                } else if (fecha_nacimiento == null || fecha_nacimiento.length == 0) {
                    $("#fecha_nacimiento").addClass("is-invalid");
                } else if (primer_apellido.length == 0 || /^\s+$/.test(primer_apellido)) {
                    $("#primer_apellido").addClass("is-invalid");
                } else if (primer_nombre.length == 0 || /^\s+$/.test(primer_nombre)) {
                    $("#primer_nombre").addClass("is-invalid");
                } else if (validateEmail(email)) {
                    $("#email").addClass("is-invalid");
                } else if (validateEmail(email_confirm)) {
                    $("#email_confirm").addClass("is-invalid");
                } else if (email != email_confirm) {
                    $("#email").addClass("is-invalid");
                    $("#email_confirm").addClass("is-invalid");
                } else if (telefono.length == 0 || !validarSiNumero(telefono)) {
                    $("#telefono").addClass("is-invalid");
                } else if (ingresos_usuario.length == 0) {
                    $("#ingresos_usuario").addClass("is-invalid");
                } else if (acceptTerms.checked == false) {
                    $("#not_accept_term").show();
                } else if (email != email_confirm) {
                    $("#email").addClass("is-invalid");
                    $("#email_confirm").addClass("is-invalid");
                } else if ((calcularEdad("fecha_nacimiento") < 17)) {
                    $("#fecha_nacimiento").addClass("is-invalid");
                } else if ((ano2 < ano1) || ((ano2 - ano1) < 18)) {
                    $("#fecha_expedicion").addClass("is-invalid");
                } else {

                    $("select").removeClass("is-invalid");
                    $("input").removeClass("is-invalid");
                    $("#not_accept_term").hide();
                    console.log("Form Correct!");

                    var d = new Date();
                    var month = d.getMonth() + 1;
                    var day = d.getDate();
                    var fecha_credito = d.getFullYear() + '-' + (month < 10 ? '0' : '') + month + '-' + (day < 10 ? '0' : '') + day + " " + "00:00:00";

                    var presol = {
                        entidad: "EDUCATIVO",
                        afiliado: afiliado,
                        monto: monto,
                        producto: "01",
                        num_cuotas: num_cuotas,
                        fecha_pago: fecha_pago,
                        id_convenio: "58",
                        fecha_credito: fecha_credito,
                        tipo_identificacion: tipo_identificacion,
                        identificacion: identificacion,
                        fecha_expedicion: fecha_expedicion,
                        primer_nombre: primer_nombre,
                        primer_apellido: primer_apellido,
                        email: email,
                        ingresos_usuario: ingresos_usuario,
                        fecha_nacimiento: fecha_nacimiento,
                        valor_cuota: valor_cuota,//Falta esto
                        valor_aval: valor_aval,//Falta esto
                        empresa: "FINTRA",
                        telefono: telefono,
                        tipo_cliente: "",
                        financia_aval: "f",
                        und_neg: "31",
                        ciudad: citys,
                        nit_empresa: "8020220161",
                        monto_renovacion: "0",
                        politica: "",
                        negocio_origen: "",
                        tipo_carrera: tipo_carrera//,
                        //asesor: "antojsh"
                    };
                    $.ajax({
                        type: "PUT",
                        url: 'http://192.168.140.155:8084/fintracredit/webresources/loans/edu-pre-approved-2',
                        async: false,
                        headers: {
                            'dataType': 'json',
                            'contentType': 'application/json',
                            'Content-Type': 'application/json',
                            'version': '2.0'
                        },
                        data: JSON.stringify(presol),
                        success: function (data) {
                            console.log('Msg:', data.data.msg);

                            alert(data.data.msg + 'Numero de Slicitud: ' + data.data.numero_solicitud);
                            $("#presolicitud")[0].reset();
                            $("#sim").hide();
                        },
                        error: function () {
                            console.log("No se ha podido obtener la informaci贸n");
                        }
                    });
                }
            });


        });

        //Utils

        //Validar numero
        function validarSiNumero(numero) { //ok
            if (/^([0-9])*$/.test(numero)) {
                return true;
            } else {
                return false
            }
        }

        //Validar Email
        function validateEmail(_mail) { //ok
            var exp = /\w+@\w+\.+([a-zA-Z]{2,4})$/;
            if (exp.test(_mail)) {
                return false;
            } else {
                return true;
            }
        }

        function validateFlied(field) { //ok
            var valueInput = $(field).val();
            var typeInput = $(field).prop('type') == 'select-one';
            var nameInput = $(field).attr("name");

            if (typeInput) { //tipo Select
                if (valueInput != null && !valueInput.length == 0) {
                    $(field).removeClass("is-invalid");
                } else {
                    $(field).addClass("is-invalid");
                }
            } else if (!typeInput && (nameInput == "email" || nameInput == "email_confirm")) { //Email 
                if (validateEmail(valueInput) || (($("#email").val()) != ($("#email_confirm").val()))) {
                    $(field).addClass("is-invalid");
                    $("#email").addClass("is-invalid");
                } else {
                    $(field).removeClass("is-invalid");
                    $("#email").removeClass("is-invalid");
                    $("#email_confirm").removeClass("is-invalid");
                }
            } else if (!typeInput && (nameInput == "primer_apellido" || nameInput == "primer_nombre")) {
                if (valueInput.length == 0 || /^\s+$/.test(valueInput)) {
                    $(field).addClass("is-invalid");
                } else {
                    $(field).removeClass("is-invalid");
                }
            } else if ((nameInput == "fecha_nacimiento")) {   //Fecha
                // let nac = $("#fecha_nacimiento").val();
                let edadFn = calcularEdad("fecha_nacimiento");
                if (edadFn < 17) {
                    $(field).addClass("is-invalid");
                } else {
                    $(field).removeClass("is-invalid");
                }
            } else if ((nameInput == "fecha_expedicion")) {   //Fecha()
                let nac = $("#fecha_nacimiento").val();
                let exp = $("#fecha_expedicion").val();
                let val1 = nac.split("-");
                let val2 = exp.split("-");
                let ano1 = val1[0];
                let ano2 = val2[0];
                if (nac != "" || nac != null) {
                    if (ano2 < ano1) {
                        $(field).addClass("is-invalid");
                    } else if ((ano2 - ano1) < 18) {
                        $(field).addClass("is-invalid");
                    } else {
                        $(field).removeClass("is-invalid");
                    }
                }
            } else if ((nameInput == "telefono" || nameInput == "ingresos_usuario")) {
                if (valueInput.length == 0 || /^\s+$/.test(valueInput)) {
                    $(field).addClass("is-invalid");
                } else {
                    $(field).removeClass("is-invalid");
                }
            } else if (nameInput == "monto") {
                if (valueInput.length == 0 || /^\s+$/.test(valueInput)) {
                    $(field).addClass("is-invalid");
                } else {
                    $(field).removeClass("is-invalid");
                }
            }
        }

        function solonumerosMonto() {//ok
            //solo numeros
            $('#monto').keypress(function (e, x) {
                if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
                    return false;
                }
            });
            //Formato de miles
            $('#monto').keyup(function (e) {
                $(this).val($(this).val().replace(/,/g, "").toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));
            });
        }

        function solonumerosIngresos() { //ok
            //solo numeros
            $('#ingresos_usuario').keypress(function (e, x) {
                if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
                    return false;
                }
            });
            //Formato de miles
            $('#ingresos_usuario').keyup(function (e) {
                $(this).val($(this).val().replace(/,/g, "").toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));
            });
        }

        function isValidDate(day, month, year) { //ok
            var dteDate;
            month = month - 1;
            // Establecemos un objeto Data con los valore recibidos
            // Los parametros son: a帽o, mes, dia, hora, minuto y segundos
            // getDate(); devuelve el dia como un entero entre 1 y 31
            // getDay(); devuelve un num del 0 al 6 indicando siel dia es lunes,
            //   martes, miercoles ...
            // getHours(); Devuelve la hora
            // getMinutes(); Devuelve los minutos
            // getMonth(); devuelve el mes como un numero de 0 a 11
            // getTime(); Devuelve el tiempo transcurrido en milisegundos desde el 1
            //   de enero de 1970 hasta el momento definido en el objeto date
            // setTime(); Establece una fecha pasandole en milisegundos el valor de esta.
            // getYear(); devuelve el a帽o
            // getFullYear(); devuelve el a帽o
            dteDate = new Date(year, month, day);

            //Devuelva true o false...
            return ((day == dteDate.getDate()) && (month == dteDate.getMonth()) && (year == dteDate.getFullYear()));
        }

        /**
         * Funcion para validar una fecha
         * Tiene que recibir:
         *  La fecha en formato ingles yyyy-mm-dd
         * Devuelve:
         *  true-Fecha correcta
         *  false-Fecha Incorrecta
         */
        function validate_fecha(fecha) {  //ok
            var patron = new RegExp("^(19|20)+([0-9]{2})([-])([0-9]{1,2})([-])([0-9]{1,2})$");

            if (fecha.search(patron) == 0) {
                var values = fecha.split("-");
                if (isValidDate(values[2], values[1], values[0])) {
                    return true;
                }
            }
            return false;
        }

        /**
         * Esta funci贸n calcula la edad de una persona y los meses
         * La fecha la tiene que tener el formato yyyy-mm-dd que es
         * metodo que por defecto lo devuelve el <input type="date">
         */
        function calcularEdad(campo) { //ok
            var fecha = document.getElementById(campo).value;
            if (validate_fecha(fecha) == true) {
                // Si la fecha es correcta, calculamos la edad
                var values = fecha.split("-");
                var dia = values[2];
                var mes = values[1];
                var ano = values[0];
                var edad = null;

                // cogemos los valores actuales
                var fecha_hoy = new Date();
                var ahora_ano = fecha_hoy.getYear();
                var ahora_mes = fecha_hoy.getMonth() + 1;
                var ahora_dia = fecha_hoy.getDate();

                // realizamos el calculo
                var edad = (ahora_ano + 1900) - ano;
                if (ahora_mes < mes) {
                    edad--;
                }
                if ((mes == ahora_mes) && (ahora_dia < dia)) {
                    edad--;
                }
                if (edad > 1900) {
                    edad -= 1900;
                }


                return edad;
            }
        }

    </script>

    <style>
        body {
            /* background: linear-gradient(90deg, rgba(2,0,36,1) 0%, rgba(9,9,121,1) 19%, rgba(0,212,255,1) 100%); */
            margin: 2em 2em;
            color: white;
            /* background-image: linear-gradient(19deg, #21D4FD 0%, #B721FF 100%); */
            background-image: linear-gradient(to right, #243949 0%, #517fa4 100%);
        }

        .inputWhithIcon input[type=text]{
            padding-left: 0px;
        }

        .inputWhithIcon{
            position: relative;
            
        }
        .inputWhithIcon i{
            position: absolute;
            right: 5px;
            top: 6px;
            padding: 0px 8px;
            
        }
    </style>
</head>

<body>
    <div class="container blue">
        <div class="row">
            <div class="col-md-12 d-flex justify-content-center ">
                <!--esto no va -->
                <div class="fusion-builder-row fusion-row">
                    <form id="presolicitud">
                        <div class="row">
                            <div class="col-md-6 form--izq">
                                <div class="form-group">
                                    <label for="ciudad">Ciudad</label>
                                    <select class="form-control" id="citys" onblur="validateFlied(this)" required>
                                        <option disabled selected value></option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6 form--der">
                                <div class="form-group">
                                    <label for="fecha-pago">Fecha primer pago</label>
                                    <select class="form-control" id="fecha_pago" onblur="validateFlied(this)" required>
                                        <option disabled selected value></option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6 form--izq">
                                <div class="form-group">
                                    <label for="instituci贸n-educativa">Instituci贸n educativa:</label>
                                    <select class="form-control" id="afiliado" onblur="validateFlied(this)" required>
                                        <option disabled selected value></option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6 form--der">
                                <div class="form-group">
                                    <label for="tipo-carrera">Tipo de carrera:</label>
                                    <select class="form-control" id="tipo_carrera" onblur="validateFlied(this)"
                                        required>
                                        <option disabled selected value></option>
                                        <option value="PREGRADO">Pregrado</option>
                                        <option value="POSGRADO">Posgrado</option>
                                        <option value="CONTINUADA">Educaci贸n Continuada</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-md-6 form--izq">
                                <div class="form-group">
                                    <label for="valor-semestre">Valor semestre:</label>
                                    <input type="text" class="form-control" id="monto" name="monto" onblur="validateFlied(this)"
                                        required>
                                </div>
                            </div>

                            <div class="col-md-6 form--der">
                                <div class="form-group">
                                    <label for="plazo-carrera">Plazo cr茅dito:</label>
                                    <select class="form-control" id="num_cuotas" onblur="validateFlied(this)" required>
                                        <option disabled selected value></option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-md-6 form--izq">
                                <div class="form-group">
                                    <label for="tipo-cc">Tipo de identificaci贸n:</label>
                                    <select class="form-control" id="tipo_identificacion" onblur="validateFlied(this)"
                                        required>
                                        <option disabled selected value></option>
                                        <option value="CED">Cedula de ciudadania</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-md-6 form--der">
                                <div class="form-group">
                                    <label for="identificacion"> Identificaci贸n:</label>
                                    <input type="number" class="form-control" id="identificacion" maxlength="10"
                                        onblur="validateFlied(this)" required>
                                </div>
                            </div>

                            <div class="col-md-6 form--der">
                                <div class="form-group">
                                    <label for="fecha-nacimiento">Fecha de nacimiento:</label>
                                    <div class="inputWhithIcon">
                                        <input type="text" class="form-control" id="fecha_nacimiento"
                                            name="fecha_nacimiento" onchange="validateFlied(this)" required readonly>
                                        <i aria-hidden="true"><img style="width: 25px" src="http://192.168.140.156/fintra/wp-content/uploads/2019/10/calendar.png"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6 form--izq">
                                <div class="form-group">
                                    <label for="fecha-exp">Fecha de expedici贸n de la c茅dula:</label>
                                    <div class="inputWhithIcon">
                                        <input type="text" class="form-control" id="fecha_expedicion"
                                            name="fecha_expedicion" onchange="validateFlied(this)" required readonly>
                                            <i aria-hidden="true"><img style="width: 25px" src="http://192.168.140.156/fintra/wp-content/uploads/2019/10/calendar.png"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6 form--izq">
                                <div class="form-group">
                                    <label for="primer-apellido">Primer Apellido:</label>
                                    <input type="text" class="form-control" id="primer_apellido" name="primer_apellido"
                                        onblur="validateFlied(this)" required pattern="[A-Za-z]+">
                                </div>
                            </div>

                            <div class="col-md-6 form--der">
                                <div class="form-group">
                                    <label for="primer-nombre">Primer nombre:</label>
                                    <input type="text" class="form-control" id="primer_nombre" name="primer_nombre"
                                        onblur="validateFlied(this)" required pattern="[A-Za-z]+">
                                </div>
                            </div>

                            <div class="col-md-6 form--izq">
                                <div class="form-group">
                                    <label for="email">Email activo:</label>
                                    <input id="email" class="form-control" title="" onblur="validateFlied(this)"
                                        name="email" type="email" required />
                                </div>
                            </div>

                            <div class="col-md-6 form--izq">
                                <div class="form-group">
                                    <label for="email">Confirmar Email:</label>
                                    <input id="email_confirm" class="form-control" onblur="validateFlied(this)"
                                        name="email_confirm" type="email" required />
                                </div>
                            </div>

                            <div class="col-md-6 form--der">
                                <div class="form-group">
                                    <label for="telefono">Celular:</label>
                                    <input type="number" class="form-control" maxlength="10" name="telefono"
                                        id="telefono" onblur="validateFlied(this)" required>
                                </div>
                            </div>

                            <div class="col-md-6 form--izq">
                                <div class="form-group">
                                    <label for="ingresos">Ingresos mensuales:</label>
                                    <input type="text" class="form-control" id="ingresos_usuario"
                                        name="ingresos_usuario" onblur="validateFlied(this)" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-8" id="sim" style="display: block; border-radius: 5px;">
                                        <button class="btn btn-secondary btn-lg btn-block" id="simular" disabled>Valor apr贸ximado de cuota $ <p style="display: inline" id="valor_cuota">250000</p></button>
                                        <p style="display: none" id="valor_aval"></p>                                                                 
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group terminos">
                                    <div class="checkbox check--box">
                                        <label><input name="remember" type="checkbox" id="acceptTerms" checked /><a href=""
                                                style="color: rgb(236, 240, 241); margin-left: 0.5rem; border-bottom: 1px #37BFFA solid;">Acepto
                                                los t茅rminos y condiciones</a></label>
                                        <p id="not_accept_term" class="text-danger" style="display: none">
                                            Debes Acptar los Terminos y condiciones</p>
                                    </div>
                                    <div class="content--btn">
                                        <button
                                            class="btn btn-secondary fusion-button button-flat simular--btn btn--general"
                                            id="simular">SIMULAR</button>

                                        <button
                                            class="btn btn-secondary fusion-button button-flat solicitar--btn btn--general"
                                            id="solicitar" disabled>SOLICITAR</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>

</html>